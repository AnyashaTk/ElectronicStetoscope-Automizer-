# ML System Design Doc - [RU]
## Дизайн ML системы - Electronic Stetoscope Automizer MVP 0.1.0

*Автоматизация обнаружения патологий сердца с помощью данных с электронного стетоскопа*   

> ### Термины и пояснения
> - Аускультация - метод диагностики, при котором с помощью стетоскопа слушают звуки, издаваемые сердцем, для оценки его работы, выявления заболеваний и аномалий
> - Спектограмма - изображение, показывающее зависимость спектральной плотности мощности сигнала от времени

### 1. Цели и предпосылки 
#### 1.1. Зачем идем в разработку продукта?  

- Product Owner для данного продукта это центр Альбрехта. В качестве бизнес метрик будет измеряться медицинская основная метрика - эффективность улучшения качества жизни пациентов
- Большинство врачей не имеют достаточно опыта для определения патологий сердца при `аускультации`, поэтому для более точного анализа требуется автоматический классификатор 
- Успехом данного проекта является разработанный алгоритм классификации наличия патологии. В лучшем случае будет передан на клинические испытания электронный стетоскоп со встроенным алгоритмом распознавания всех видов патологий 

#### 1.2. Бизнес-требования и ограничения  

- Алгоритм должен принимать на вход аудиофайл с записью с электростетоскопа, на выходе возвращать либо значения 1\0, либо в лучшем случае вектор со значениями 1\0 для каждой патологии  
- Проект должен иметь возможность работать локально, без использования гпу
- В течение первой итерации ожидается MVP продукта из алгоритма бинарной классификации и одностраничного сайта для возможности тестирования алгоритма 
- Алгоритм будет использоваться для исследований центра Альбрехта и создания нового медицинского прибора
- Опираться в первую очередь будем на метрики: для бинарной классификации точность 0.9 и выше, так как в [задачах подобного рода](https://www.imrpress.com/journal/RCM/24/6/10.31083/j.rcm2406175) это не является редким результатом
- Отношение сигнал/шум (SNR) после очистки данныхЦелевое значение: SNR > 20 дБ, удаление речи > 95%
- Точность определения пульса определяем через RMSE значение, целевое - RMSE < 3 удара в минуту
- Так же будем отслеживать метрики Recall(>0.85), Precision(>0.8) и Specificity(>0.7), в данном случае нам важнее не упустить пациентов, которых нужно дополнительно обследовать на наличие патологии, чем предложить здоровому пациенту дообследоваться (аускультация никогда не является единственным фактором для выставления диагноза)
- Для multilabel классификации проще всего будет использовать в качестве единой метрики будет выступать взвешенная f1 мера, и в качестве более подробного набора метрик - матрица ошибок каждого класса.

#### 1.3. Что входит в скоуп проекта/итерации, что не входит   
  
- В первую итерацию входит EDA данных, полученных от Product Owner, анализ открытых датасетов, планирование и проведение экспериментов по предобработке данных и классификации наличия патологий
- По итогам итерации клиенту будет передан репозиторий с сервисом для поднятия одностраничного сайта для обработки аудиофайлов, полученных с помощью электронного стетоскопа, и веса модели. Алгоритмы обучения модели клиенту не требуются на данный момент
- Дальнейшие разработки включают в себя улучшение качества предобработки данных и классификации, поднятие метрик, расширение количества или видов патологий. Помощь со встраиванием алгоритма в новое устройство, на данный момент они не входят в скоуп задач  

### 2. Методология `Data Scientist`     

#### 2.1. Постановка задачи  

Для составления решения будут разработаны и проверены:
- Алгоритм очистки данных от участков с человеческой речью (SNR > 20 дБ, удаление речи > 95%)
- Алгоритм подсчета пульса (RMSE < 3 удара в минуту)
- Алгоритм бинарной классификации наличия патологий (Recall(>0.85), Precision(>0.8) и Specificity(>0.7))
- Сервис с одностраничным сайтом для работы с аудиофайлами (Планируется использовать FastApi)
- Документация по работе с сайтом (.md)

#### 2.1. Блок-схема решения

Бейзлайн планируется реализовать следующим образом:

<image src="/docs/images/baseline.png" alt="Baseline scheme">